<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Analytics Report - {{ driver_name }}</title>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üìä Analytics Report</h1>
        <div class="subtitle">Driver Performance Summary</div>
    </div>

    <!-- Driver Information -->
    <div class="driver-info">
        <p><strong>Driver:</strong> {{ driver_name }}</p>
        <p><strong>Phone:</strong> {{ driver_phone }}</p>
        <p><strong>Email:</strong> {{ driver_email }}</p>
        <p><strong>Period:</strong> {{ start_date|date:"d/m/Y" }} - {{ end_date|date:"d/m/Y" }}</p>
        <p><strong>Generated:</strong> {{ generated_at|date:"d/m/Y H:i" }}</p>
    </div>

    <!-- Summary Statistics -->
    <div class="section">
        <h2 class="section-title">üìà Summary Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card highlight">
                <span class="stat-value">{{ summary.total_deliveries }}</span>
                <span class="stat-label">Total Deliveries</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ summary.completed_deliveries }}</span>
                <span class="stat-label">Completed</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ summary.success_rate|floatformat:1 }}%</span>
                <span class="stat-label">Success Rate</span>
            </div>
            <div class="stat-card highlight">
                <span class="stat-value">{{ summary.total_earnings|floatformat:0 }} DA</span>
                <span class="stat-label">Total Earnings</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ summary.total_distance_km|floatformat:1 }} km</span>
                <span class="stat-label">Distance Traveled</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ summary.average_delivery_value|floatformat:0 }} DA</span>
                <span class="stat-label">Avg. Value</span>
            </div>
        </div>
    </div>

    <!-- Earnings Breakdown -->
    <div class="section">
        <h2 class="section-title"> Earnings Breakdown</h2>
        <div class="earnings-breakdown">
            <div class="earning-row">
                <span>Delivery Earnings</span>
                <span><strong>{{ earnings_breakdown.delivery_earnings|floatformat:2 }} DA</strong></span>
            </div>
            <div class="earning-row">
                <span>Bonus Earnings</span>
                <span><strong>{{ earnings_breakdown.bonus_earnings|floatformat:2 }} DA</strong></span>
            </div>
            <div class="earning-row">
                <span>Tip Earnings</span>
                <span><strong>{{ earnings_breakdown.tip_earnings|floatformat:2 }} DA</strong></span>
            </div>
            <div class="earning-row">
                <span>Adjustments</span>
                <span><strong>{{ earnings_breakdown.adjustment_earnings|floatformat:2 }} DA</strong></span>
            </div>
            <div class="earning-row total">
                <span>Total Earnings</span>
                <span>{{ earnings_breakdown.total_earnings|floatformat:2 }} DA</span>
            </div>
        </div>
    </div>

    <!-- Status Distribution -->
    <div class="section">
        <h2 class="section-title">üìä Status Distribution</h2>
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for item in status_distribution %}
                <tr>
                    <td>
                        {% if item.status == 'delivered' %}
                            <span class="badge success">{{ item.status|upper }}</span>
                        {% elif item.status == 'cancelled' %}
                            <span class="badge danger">{{ item.status|upper }}</span>
                        {% elif item.status == 'pending' %}
                            <span class="badge warning">{{ item.status|upper }}</span>
                        {% else %}
                            <span class="badge info">{{ item.status|upper }}</span>
                        {% endif %}
                    </td>
                    <td>{{ item.count }}</td>
                    <td>{% widthratio item.count summary.total_deliveries 100 %}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Distance Distribution -->
    <div class="section">
        <h2 class="section-title">üöó Distance Distribution</h2>
        <table>
            <thead>
                <tr>
                    <th>Range</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for range in distance_distribution %}
                <tr>
                    <td>{{ range.range_label }}</td>
                    <td>{{ range.count }}</td>
                    <td>{% widthratio range.count summary.total_deliveries 100 %}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Peak Hours -->
    <div class="section">
        <h2 class="section-title">‚è∞ Peak Hours (Top 10)</h2>
        <table>
            <thead>
                <tr>
                    <th>Hour</th>
                    <th>Deliveries</th>
                    <th>Earnings</th>
                </tr>
            </thead>
            <tbody>
                {% for hour in peak_hours|slice:":10" %}
                <tr>
                    <td>{{ hour.hour }}:00 - {{ hour.hour }}:59</td>
                    <td>{{ hour.deliveries_count }}</td>
                    <td>{{ hour.total_earnings|floatformat:2 }} DA</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Top Communes -->
    <div class="section">
        <h2 class="section-title">üìç Top Delivery Locations</h2>
        <table>
            <thead>
                <tr>
                    <th>Commune</th>
                    <th>Deliveries</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for commune in commune_stats %}
                <tr>
                    <td>{{ commune.commune|default:"Unknown" }}</td>
                    <td>{{ commune.deliveries_count }}</td>
                    <td>{% widthratio commune.deliveries_count summary.total_deliveries 100 %}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Timeline Summary -->
    {% if timeline %}
    <div class="section">
        <h2 class="section-title">üìÖ Daily Timeline</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Deliveries</th>
                    <th>Earnings</th>
                </tr>
            </thead>
            <tbody>
                {% for day in timeline %}
                <tr>
                    <td>{{ day.date }}</td>
                    <td>{{ day.deliveries_count }}</td>
                    <td>{{ day.total_earnings|floatformat:2 }} DA</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Footer -->
    <div class="footer">
        <p>This report was automatically generated by Lebenis Delivery System</p>
        <p>¬© {{ generated_at|date:"Y" }} Lebenis - All rights reserved</p>
        <p>For support, contact: support@lebenis.com</p>
    </div>
</body>
</html>
